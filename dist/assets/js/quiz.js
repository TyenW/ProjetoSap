let allQuestions=[],masterAchievements=[];const DEFAULT_ACHIEVEMENTS=[{id:"streak3",title:"3 Acertos Seguidos",description:"Acerte 3 quest√µes consecutivas",icon:"üî•",goal:{type:"streak",target:3}},{id:"pro",title:"Acertou >= 80%",description:"Mantenha precis√£o de 80% ou mais em uma sess√£o",icon:"üéØ",goal:{type:"accuracy",target:80}},{id:"perfect",title:"Pontua√ß√£o Perfeita",description:"Acerte 100% das perguntas de uma sess√£o",icon:"üåü"},{id:"answered10",title:"Aquecendo",description:"Responda 10 perguntas",icon:"‚úÖ",goal:{type:"answered",target:10}},{id:"answered50",title:"Maratonista",description:"Responda 50 perguntas",icon:"üèÉ",goal:{type:"answered",target:50}},{id:"score20",title:"Pontuador",description:"Alcance 20 pontos em uma sess√£o",icon:"‚ö°",goal:{type:"score",target:20}}],DEFAULT_QUESTIONS=[{text:"O que significa SAP em SAP-1?",options:["Simple As Possible","Systematic Arithmetic Processor","Standard Architecture Platform","Single Accumulator Processor"],answer:0,difficulty:"f√°cil"},{text:"Qual registrador aponta para a pr√≥xima instru√ß√£o?",options:["IR","MAR","PC","A"],answer:2,difficulty:"f√°cil"},{text:"Quantos estados T tem o ciclo de m√°quina do SAP-1?",options:["4","6","8","2"],answer:1,difficulty:"f√°cil"},{text:"Qual instru√ß√£o carrega um valor da RAM para o Acumulador?",options:["OUT","ADD","HLT","LDA"],answer:3,difficulty:"m√©dio"},{text:"Qual √© a fun√ß√£o do sinal Ep?",options:["Incrementar o PC","Colocar o conte√∫do do PC no barramento","Carregar valor no PC","Zerar o PC"],answer:1,difficulty:"m√©dio"}];let TRI_MODE="infinite";function showDataAlert(e,t="warn"){try{const o=document.getElementById("message");if(o)return o.textContent=e,void(o.style.color="error"===t?"#ff6b6b":"#ffb347");let a=document.getElementById("quiz-data-alert");a||(a=document.createElement("div"),a.id="quiz-data-alert",a.setAttribute("role","alert"),a.style.position="fixed",a.style.top="8px",a.style.left="50%",a.style.transform="translateX(-50%)",a.style.zIndex=9999,a.style.padding="10px 14px",a.style.borderRadius="8px",a.style.fontFamily="inherit",a.style.fontSize="0.9rem",a.style.boxShadow="0 2px 10px rgba(0,0,0,0.4)",document.body.appendChild(a)),a.style.background="error"===t?"#7a1f1f":"#7a5a1f",a.style.color="#fff",a.textContent=e,clearTimeout(a._timer),a._timer=setTimeout(()=>a.remove(),6e3)}catch(e){}}async function loadExternalData(){try{const e=await fetch("assets/data/questions.json",{cache:"no-store"});if(e.ok){const t=await e.json();Array.isArray(t.questions)?allQuestions=t.questions:console.warn('questions.json n√£o possui "questions" como array.')}else console.warn("Falha HTTP ao buscar questions.json:",e.status,e.statusText),showDataAlert(`N√£o foi poss√≠vel carregar perguntas (HTTP ${e.status}). Usando perguntas padr√£o.`,"warn")}catch(e){console.warn("Falha ao carregar questions.json, usando fallback interno se existir",e),showDataAlert("Erro ao carregar questions.json (CORS/offline/JSON inv√°lido). Usando perguntas padr√£o.","warn")}allQuestions&&0!==allQuestions.length||(console.warn("Usando perguntas padr√£o (fallback), verifique se assets/data/questions.json est√° acess√≠vel via HTTP e com JSON v√°lido."),allQuestions=DEFAULT_QUESTIONS);try{const e=await fetch("assets/data/achievements.json",{cache:"no-store"});if(e.ok){const t=await e.json();Array.isArray(t.achievements)?masterAchievements=t.achievements:console.warn('achievements.json n√£o possui "achievements" como array, usando fallback.')}else console.warn("Falha HTTP ao buscar achievements.json:",e.status,e.statusText),showDataAlert(`N√£o foi poss√≠vel carregar conquistas (HTTP ${e.status}). Usando padr√£o.`,"warn")}catch(e){console.warn("Falha ao carregar achievements.json",e),showDataAlert("Erro ao carregar achievements.json (CORS/offline/JSON inv√°lido). Usando conquistas padr√£o.","warn")}masterAchievements&&0!==masterAchievements.length||(console.warn("Usando conquistas padr√£o (fallback), verifique se assets/data/achievements.json est√° acess√≠vel via HTTP e com JSON v√°lido."),masterAchievements=DEFAULT_ACHIEVEMENTS)}let lives=3,currentQ=0,score=0,acertosSeguidos=0,usedQuestions=[],quizSet=[],respostasCorretas=[],answeredCount=0,maxStreak=0;function getRandomQuestion(e){const t=allQuestions.filter(t=>t.difficulty===e&&!usedQuestions.includes(t));return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}function selectAdaptiveQuestion(){let e;e=score<3?"f√°cil":score<6?"m√©dio":"dif√≠cil";let t=getRandomQuestion(e);return t||(allQuestions.find(e=>!usedQuestions.includes(e))||null)}function selectRandomQuestion(){if(!allQuestions||0===allQuestions.length)return null;const e=allQuestions.filter(e=>!usedQuestions.includes(e));return 0===e.length?(usedQuestions=[],allQuestions[Math.floor(Math.random()*allQuestions.length)]):e[Math.floor(Math.random()*e.length)]}function selectByDifficulty(e){const t=allQuestions.filter(t=>t.difficulty===e&&!usedQuestions.includes(t));return t.length>0?t[Math.floor(Math.random()*t.length)]:allQuestions.find(e=>!usedQuestions.includes(e))||null}function renderQuestion(){if(0===lives)return endQuiz();const e=quizSet[currentQ];if(!e){const e=document.getElementById("message");return void(e&&(e.textContent="N√£o h√° perguntas dispon√≠veis no momento.",e.style.color="#ffd700"))}const t=document.getElementById("question");t&&(t.innerText=`[${(e.difficulty||"").toUpperCase()}] ${e.text}`);const o=document.getElementById("current-q");o&&(o.innerText=currentQ+1);const a=document.getElementById("lives");a&&(a.innerText="‚ù§Ô∏è".repeat(lives));const n=document.getElementById("options");n.innerHTML="",e.options.forEach((e,t)=>{const o=document.createElement("button");o.textContent=e,o.onclick=()=>checkAnswer(t),o.addEventListener("touchstart",()=>o.classList.add("pressed")),o.addEventListener("touchend",()=>o.classList.remove("pressed")),n.appendChild(o)}),document.getElementById("message").textContent=""}function checkAnswer(e){const t=e===quizSet[currentQ].answer,o=document.getElementById("message"),a=document.getElementById("options"),n=Array.from(a.querySelectorAll("button")),s=n[e];if(n.forEach(e=>e.disabled=!0),t)score++,acertosSeguidos++,acertosSeguidos>maxStreak&&(maxStreak=acertosSeguidos),o.textContent="Correto!",o.style.color="green",respostasCorretas.push(!0),s&&s.classList.add("correct");else{lives--,acertosSeguidos=0,o.textContent="Errado!",o.style.color="red",respostasCorretas.push(!1),s&&s.classList.add("wrong");const e=document.getElementById("lives");e.classList.add("remove"),setTimeout(()=>e.classList.remove("remove"),350)}document.getElementById("lives").innerText="‚ù§Ô∏è".repeat(lives),answeredCount++;const r=document.getElementById("answered-count");r&&(r.textContent=answeredCount),renderAchievementsList(),currentQ++,setTimeout(()=>{if(lives<=0)endQuiz();else{const e=selectRandomQuestion();if(!e)return void endQuiz();quizSet.push(e),usedQuestions.push(e),n.forEach(e=>{e.classList.remove("correct","wrong","pressed")}),renderQuestion()}},1500)}function endQuiz(){document.getElementById("options").innerHTML="",document.getElementById("restartBtn").style.display="block",0===lives?(document.getElementById("question").innerText="‚ò†Ô∏è GAME OVER!",document.getElementById("message").innerHTML=`<div class="game-over">Voc√™ perdeu todas as vidas! Acertou ${score} perguntas.</div>`):(document.getElementById("question").innerText="üéâ PARAB√âNS!",document.getElementById("message").innerHTML=`<div class="win-message">Voc√™ completou o quiz! Pontua√ß√£o: ${score} pts</div>`),renderChart();try{setCookie("sap_last_score",score,7),setCookie("sap_last_date",(new Date).toISOString(),7)}catch(e){}try{submitScoreToLeaderboard(score)}catch(e){}}function startQuiz(){lives=3,currentQ=0,score=0,acertosSeguidos=0,usedQuestions=[],quizSet=[],respostasCorretas=[],answeredCount=0,maxStreak=0,document.getElementById("message").innerHTML="",document.getElementById("restartBtn").style.display="none";const e=selectRandomQuestion();if(e)quizSet.push(e),usedQuestions.push(e);else{const e=document.getElementById("message");e&&(e.textContent="Falha ao carregar perguntas. Verifique o arquivo questions.json.",e.style.color="orange")}renderQuestion()}function renderChart(){document.getElementById("chartModal").style.display="block";const e=document.getElementById("performanceChartModal").getContext("2d"),t={"f√°cil":{total:0,acertos:0},"m√©dio":{total:0,acertos:0},"dif√≠cil":{total:0,acertos:0}};quizSet.forEach((e,o)=>{t[e.difficulty].total++,respostasCorretas[o]&&t[e.difficulty].acertos++});const o={labels:["F√°cil","M√©dio","Dif√≠cil"],datasets:[{label:"Acertos",data:[t.f√°cil.acertos,t.m√©dio.acertos,t.dif√≠cil.acertos],backgroundColor:["#4caf50","#ff9800","#f44336"]},{label:"Total",data:[t.f√°cil.total,t.m√©dio.total,t.dif√≠cil.total],backgroundColor:["#a5d6a7","#ffcc80","#ef9a9a"]}]};window.performanceChartInstance&&window.performanceChartInstance.destroy(),window.performanceChartInstance=new Chart(e,{type:"bar",data:o,options:{responsive:!0,scales:{y:{beginAtZero:!0,stepSize:1}}}})}function closeChart(){document.getElementById("chartModal").style.display="none"}function exportarEstatisticas(){const e={"f√°cil":{total:0,acertos:0},"m√©dio":{total:0,acertos:0},"dif√≠cil":{total:0,acertos:0}};quizSet.forEach((t,o)=>{e[t.difficulty].total++,respostasCorretas[o]&&e[t.difficulty].acertos++});const t=["=== Estat√≠sticas do Quiz SAP-1 ===",`Data: ${(new Date).toLocaleString()}`,"",`Pontua√ß√£o total: ${score}/${quizSet.length}`,"","Por n√≠vel de dificuldade:"];for(const o in e){const{acertos:a,total:n}=e[o],s=(a/(n||1)*100).toFixed(1);t.push(`${o.toUpperCase()}: ${a}/${n} acertos (${s}%)`)}const o=new Blob([t.join("\n")],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download="estatisticas_sap1.txt",n.click()}const music=document.getElementById("bg-music"),toggle=document.getElementById("muteToggle");toggle.onclick=()=>{music.muted=!music.muted,toggle.textContent=music.muted?"üîá":"üîä"};const ACHIEVEMENTS_KEY="sap_quiz_achievements";let _storageWarned=!1;function lsGet(e,t=null){try{const o=localStorage.getItem(e);return null==o?t:o}catch(e){return _storageWarned||(showDataAlert("Armazenamento desativado pelo navegador. Progresso pode n√£o ser salvo.","warn"),_storageWarned=!0),t}}function lsSet(e,t){try{return localStorage.setItem(e,t),!0}catch(e){return _storageWarned||(showDataAlert("Armazenamento desativado pelo navegador. Progresso pode n√£o ser salvo.","warn"),_storageWarned=!0),!1}}async function submitScoreToLeaderboard(e){try{let t=lsGet("sap_player_name","")||"";if(t=(t||"").trim(),!t){if(t=(prompt("Digite seu nome para o ranking:")||"").trim(),!t)return void showDataAlert("Nome vazio: pontua√ß√£o n√£o registrada no ranking.","warn");lsSet("sap_player_name",t)}const o={name:t.slice(0,32),score:Number(e)||0},a=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)return void showDataAlert(`Falha ao registrar no ranking (HTTP ${a.status}).`,"warn");await a.json(),showDataAlert("Pontua√ß√£o registrada no ranking! ‚úÖ","ok")}catch(e){console.warn("Falha ao registrar no leaderboard:",e),showDataAlert("N√£o foi poss√≠vel registrar no ranking (offline/CORS).","warn")}}function loadAchievements(){try{return JSON.parse(lsGet(ACHIEVEMENTS_KEY,"[]"))}catch(e){return[]}}function setCookie(e,t,o){try{const a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3);const n="expires="+a.toUTCString(),s=encodeURIComponent(JSON.stringify(t));document.cookie=`${e}=${s}; ${n}; path=/`}catch(e){console.warn("setCookie falhou",e)}}function getCookie(e){try{const t=document.cookie.split(";").map(e=>e.trim());for(const o of t)if(o.startsWith(e+"=")){const t=o.substring(e.length+1);return JSON.parse(decodeURIComponent(t))}}catch(e){}return null}function saveAchievement(e,t){const o=loadAchievements();if(!o.find(t=>t.id===e)){o.push({id:e,title:t,date:(new Date).toISOString()}),lsSet(ACHIEVEMENTS_KEY,JSON.stringify(o));try{setCookie(ACHIEVEMENTS_KEY,o,30)}catch(e){}showAchievementToast(t)}}function showAchievementToast(e){const t=document.createElement("div");t.className="achievement-toast",t.textContent=`üèÜ Conquista desbloqueada: ${e}`,document.body.appendChild(t),setTimeout(()=>{t.classList.add("visible")},50),setTimeout(()=>{t.classList.remove("visible"),setTimeout(()=>t.remove(),400)},3500)}const LEADERBOARD_KEY="sap_quiz_leaderboard",LEADERBOARD_API="/api/leaderboard",LEADERBOARD_API_OVERRIDE_KEY="sap_quiz_leaderboard_api";let LB_API_SELECTED=null;function readApiOverrideFromQuery(){try{const e=new URLSearchParams(window.location.search),t=e.get("lbApi")||e.get("api");if(t&&/^https?:\/\//i.test(t)){try{localStorage.setItem("sap_quiz_leaderboard_api",t)}catch(e){}return t}}catch(e){}return null}function readApiOverrideFromStorage(){try{return localStorage.getItem("sap_quiz_leaderboard_api")}catch(e){return null}}function readApiOverrideFromWindow(){try{return"string"==typeof window.LEADERBOARD_API&&window.LEADERBOARD_API?window.LEADERBOARD_API:null}catch(e){return null}}function readApiOverrideFromMeta(){try{const e=document.querySelector('meta[name="leaderboard-api"]');return e&&e.content?e.content:null}catch(e){return null}}function getApiCandidates(){const e=[],t=readApiOverrideFromQuery();t&&e.push(t);const o=readApiOverrideFromStorage();o&&e.push(o);const a=readApiOverrideFromWindow();a&&e.push(a);const n=readApiOverrideFromMeta();n&&e.push(n);try{e.push(new URL(LEADERBOARD_API,window.location.origin).href)}catch(e){}e.push("http://localhost:8000/api/leaderboard");const s=new Set;return e.filter(e=>{if(!e)return!1;const t=e.trim();return!s.has(t)&&(s.add(t),!0)})}async function pickLeaderboardApi(){if(LB_API_SELECTED)return LB_API_SELECTED;const e=getApiCandidates();for(const t of e)try{if((await fetch(t,{method:"GET",cache:"no-store",mode:"cors"})).ok)return LB_API_SELECTED=t,t}catch(e){}return null}async function remoteLoadLeaderboard(){try{const e=await pickLeaderboardApi();if(!e)throw new Error("api indispon√≠vel");const t=await fetch(e,{cache:"no-store"});if(!t.ok)throw new Error("http "+t.status);const o=await t.json();return Array.isArray(o)?o:[]}catch(e){return console.warn("remoteLoadLeaderboard falhou, usando local:",e.message||e),null}}async function remoteSaveLeaderboard(e,t){try{const o=await pickLeaderboardApi();if(!o)throw new Error("api indispon√≠vel");const a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({name:e,score:t})});if(!a.ok)throw new Error("http "+a.status);const n=await a.json();return Array.isArray(n)?n:[]}catch(e){return console.warn("remoteSaveLeaderboard falhou, fallback local:",e.message||e),null}}function localLoadLeaderboard(){return[]}function seedLeaderboardIfEmpty(){}async function saveToLeaderboard(e,t){const o=await remoteSaveLeaderboard(e,t);if(o&&Array.isArray(o))return renderLeaderboard(o),void showSaveToast(`${e} adicionado ao placar (global)!`);const a=localLoadLeaderboard();a.push({name:e||"---",score:t,date:(new Date).toISOString()}),a.sort((e,t)=>t.score-e.score||new Date(e.date)-new Date(t.date));const n=a.slice(0,10);lsSet(LEADERBOARD_KEY,JSON.stringify(n));try{setCookie(LEADERBOARD_KEY,n,30)}catch(e){}renderLeaderboard(n),showDataAlert("Servidor indispon√≠vel. Placar salvo localmente nesta m√°quina.","warn")}function showSaveToast(e){const t=document.createElement("div");t.className="achievement-toast",t.textContent=`‚úÖ ${e}`,document.body.appendChild(t),setTimeout(()=>{t.classList.add("visible")},50),setTimeout(()=>{t.classList.remove("visible"),setTimeout(()=>t.remove(),400)},2800)}async function renderLeaderboard(e){const t=document.getElementById("leaderboard");if(!t)return;let o=Array.isArray(e)?e:await remoteLoadLeaderboard();Array.isArray(o)||(o=localLoadLeaderboard());const a=["ü•á","ü•à","ü•â"],n=[...o];for(let e=n.length;e<10;e++)n.push({name:"---",score:0,date:new Date(0).toISOString(),_placeholder:!0});t.innerHTML='<h3>üèÖ Placar de L√≠deres (Top 10)</h3><ol class="lb-list">'+n.map((e,t)=>{const o=a[t]||t+1,n=`lb-row lb-${t+1}`+(e._placeholder?" lb-empty":""),s=e._placeholder?"--/--/----":new Date(e.date).toLocaleDateString(),r=(e.score||0)+" pts";return`<li class="${n}"><span class="lb-medal">${o}</span><span class="lb-name">${e.name}</span><span class="lb-score">${r}</span><span class="lb-date">${s}</span></li>`}).join("")+"</ol>"}function exportResults(e="txt"){const t={"f√°cil":{total:0,acertos:0},"m√©dio":{total:0,acertos:0},"dif√≠cil":{total:0,acertos:0}};quizSet.forEach((e,o)=>{t[e.difficulty].total++,respostasCorretas[o]&&t[e.difficulty].acertos++});const o={date:(new Date).toISOString(),score:score,totalQuestions:quizSet.length,perDifficulty:t,questions:quizSet.map((e,t)=>({text:e.text,difficulty:e.difficulty,correct:respostasCorretas[t]||!1}))};if("json"===e)downloadBlob(new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),"quiz_sap1.json");else if("csv"===e){const e=["pergunta,dificuldade,acertou"];o.questions.forEach(t=>e.push(`"${t.text.replace(/"/g,'""')}",${t.difficulty},${t.correct}`)),downloadBlob(new Blob([e.join("\n")],{type:"text/csv"}),"quiz_sap1.csv")}else{const e=[];e.push("=== Estat√≠sticas do Quiz SAP-1 ==="),e.push(`Data: ${(new Date).toLocaleString()}`),e.push(`Pontua√ß√£o total: ${score}/${quizSet.length}`),e.push("Por n√≠vel de dificuldade:");for(const o in t){const{acertos:a,total:n}=t[o],s=(a/(n||1)*100).toFixed(1);e.push(`${o.toUpperCase()}: ${a}/${n} acertos (${s}%)`)}downloadBlob(new Blob([e.join("\n")],{type:"text/plain;charset=utf-8"}),"estatisticas_sap1.txt")}}function downloadBlob(e,t){const o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download=t,a.click(),setTimeout(()=>URL.revokeObjectURL(o),5e3)}function startTutorial(){const e=document.getElementById("tutorialOverlay");e&&(e.style.display="block",e.classList.add("visible"))}function closeTutorial(){const e=document.getElementById("tutorialOverlay");e&&(e.classList.remove("visible"),setTimeout(()=>e.style.display="none",300))}function attachTouchHandlers(){const e=document.getElementById("options");e&&(e.addEventListener("touchstart",e=>{const t=e.target.closest("button");t&&t.classList.add("pressed")},{passive:!0}),e.addEventListener("touchend",e=>{const t=e.target.closest("button");t&&t.classList.remove("pressed")}))}function handleEndQuizSave(){score===quizSet.length&&saveAchievement("perfect","Pontua√ß√£o Perfeita"),score>=Math.ceil(.8*quizSet.length)&&saveAchievement("pro","Acertou >= 80%"),acertosSeguidos>=3&&saveAchievement("streak3","3 Acertos Seguidos"),setTimeout(()=>{openNameModal(score)},300)}function renderAchievementsList(){const e=document.getElementById("achievements");if(!e)return;const t=loadAchievements(),o=computeStats();if(masterAchievements&&masterAchievements.length){const a=masterAchievements.length,n=t.length,s=masterAchievements.map(e=>{const a=t.find(t=>t.id===e.id),{pct:n,text:s}=computeAchievementProgress(e,o,a),r=a?"unlocked":"locked",i=e.icon?e.icon:a?"üèÜ":"üîí";return`\n        <div class="ach-card ${r}" title="${e.description||""}">\n          <div class="ach-head">\n            <span class="ach-icon">${i}</span>\n            <span class="ach-title">${e.title}</span>\n          </div>\n          <div class="ach-desc">${e.description||""}</div>\n          <div class="ach-progress"><div class="ach-progress-fill" style="width:${n}%;"></div></div>\n          <div class="ach-progress-text">${n}% ‚Ä¢ ${s}</div>\n        </div>`}).join("");e.innerHTML=`<h3>üèÜ Conquistas (${n}/${a})</h3><div class="ach-grid">${s}</div>`}else e.innerHTML='<h3>üèÜ Conquistas</h3><div class="empty-ach">Carregue achievements.json para ver a lista completa</div>'}function computeStats(){const e=answeredCount>0?Math.round(score/answeredCount*100):0;return{score:score,answeredCount:answeredCount,maxStreak:maxStreak,accuracy:e,lives:lives}}function computeAchievementProgress(e,t,o){if(o)return{pct:100,text:"Conquistada"};const a=e.goal||{},n=a.type||e.id,s=a.target||("streak3"===e.id?3:"pro"===e.id?80:100);let r=0,i="";switch(n){case"streak":case"streak3":r=Math.min(100,Math.round(t.maxStreak/s*100)),i=`Streak: ${t.maxStreak}/${s}`;break;case"accuracy":case"pro":r=Math.min(100,Math.round(t.accuracy/s*100)),i=`Precis√£o: ${t.accuracy}% (meta ${s}%)`;break;case"perfect":r=100===t.accuracy&&t.answeredCount>0?100:Math.min(99,t.accuracy),i=100===t.accuracy&&t.answeredCount>0?"Perfeito!":"Acerte 100% em uma sess√£o";break;case"answered":r=Math.min(100,Math.round(t.answeredCount/(s||10)*100)),i=`Responda ${s} perguntas (${t.answeredCount})`;break;case"score":r=Math.min(100,Math.round(t.score/(s||10)*100)),i=`Pontua√ß√£o: ${t.score}/${s}`;break;default:r=0,i="Progrida jogando"}return{pct:r,text:i}}const originalEndQuiz=endQuiz;function openNameModal(e){const t=document.getElementById("nameModal");t&&(document.getElementById("modalScore").textContent=e,t.style.display="flex")}function closeNameModal(){const e=document.getElementById("nameModal");e&&(e.style.display="none")}function wireQuizUI(){const e=document.getElementById("saveNameBtn"),t=document.getElementById("cancelNameBtn"),o=document.getElementById("playerNameInput");e&&(e.onclick=()=>{const e=(o?.value||"").trim();e?(saveToLeaderboard(e,score),closeNameModal()):alert("Digite um nome para salvar no placar.")}),t&&(t.onclick=()=>closeNameModal())}endQuiz=function(){originalEndQuiz(),handleEndQuizSave()},loadExternalData().then(()=>{attachTouchHandlers(),renderLeaderboard(),renderAchievementsList(),wireQuizUI(),startQuiz()}).catch(e=>{console.warn("Erro na inicializa√ß√£o dos dados externos",e),attachTouchHandlers(),renderLeaderboard(),renderAchievementsList(),wireQuizUI(),startQuiz()});